import{c as t,t as e,a2 as n,b9 as i,ba as s,e as a,a1 as r,q as d,H as c,bb as o,h as l,p as f,D as u,am as p,aD as h,A as m,x as b,aY as y,a as v}from"./calfSystem-6459f18a.js"
import{i as g}from"./isArray-0709f57e.js"
import"./numberIsNaN-fa7d637d.js"
import"./currentGuildId-da0b8fda.js"
import{i as k}from"./intValue-e8157483.js"
import{s as _,g as x}from"./idb-737f325b.js"
import{c as I}from"./createTable-0679902c.js"
import"./dialogMsg-27e2dc98.js"
import{e as R}from"./executeAll-be2ac0ec.js"
import{d as L}from"./daAjaxSendItemsToRecipient-2adf8442.js"
import{e as M}from"./errorDialog-f6569d61.js"
import{i as E}from"./indexAjaxJson-14aa1022.js"
import"./cmdExport-7faecab1.js"
import{g as S}from"./getInventory-5521ae48.js"
import{l as j,p as D}from"./lvlTests-a02a80a7.js"
import"./all-36f83e81.js"
import{l as T}from"./loadDataTables-5d301d53.js"
import"./daUseItem-3b77cb95.js"
import{d as N}from"./daLoadInventory-f8bb7457.js"
import{d as w}from"./dialog-81b3293d.js"
import{a as A,e as G,u as q}from"./useItem-4fe503f3.js"
import{g as P}from"./guild-c7684629.js"
import{a as U}from"./allthen-7d061027.js"
import{c as C}from"./changeMinMax-649d8c61.js"
import{i as O}from"./isSelected-9a0f1276.js"
import{g as F}from"./getMembrList-78f4e922.js"
import{q as W,a as B}from"./queue-a14fef99.js"
import{g as V}from"./guildInventory-ecc11c54.js"
import{n as H}from"./notLastUpdate-808bc69b.js"
function Y(){return P({subcmd:"fetchinv"})}function Q(){return V({subcmd2:"report"})}let z,J=[]
function X(t){z=t}const K=t=>15===t.t
function Z(t){g(t.r)&&(J=Array.prototype.concat.apply([],t.r.map(t=>t.items)).filter(K))}function tt(t){g(t.r)&&(J=J.concat(t.r.filter(K)))}function et(t,e){return e.a===t}function nt(t){if(15===t.type){const n=J.find(e(et,t.inv_id))
n&&(t.item_name=n.n)}}function it(){z.items.forEach(nt)}function st(){const e=[S().then(X)]
return"invmanagernew"===t.subcmd&&e.push(N().then(Z)),"guildinvmgr"===t.subcmd&&(e.push(Y().then(tt)),e.push(Q().then(tt))),U(e,it)}function at(t,e){e.val(""),$(t).DataTable().search("").draw()}function rt(){z.folders&&(z.folders[-1]="Main")}const dt={checkedElements:{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},fshMinLvl:1,fshMaxLvl:9999},ct='<table class="fshInvFilter"><tr><th colspan="14">@@reportTitle@@</th><th><span id="fshRefresh" class="fshLink">[Refresh]</span></th></tr><tr><td colspan="2" rowspan="3"><b>&nbsp;Show Items:</b></td><td class="fshRight">&nbsp;Helmet:</td><td><input id="fshHelmet" type="checkbox" item="0"/></td><td class="fshRight">&nbsp;Armor:</td><td><input id="fshArmor" type="checkbox" item="1"/></td><td class="fshRight">&nbsp;Gloves:</td><td><input id="fshGloves" type="checkbox" item="2"/></td><td class="fshRight">&nbsp;Boots:</td><td><input id="fshBoots" type="checkbox" item="3"/></td><td class="fshRight">&nbsp;Weapon:</td><td><input id="fshWeapon" type="checkbox" item="4"/></td><td></td><td class="fshRight">&nbsp;Min lvl:</td><td><input id="fshMinLvl" size="5" value="1"/></td></tr><tr><td class="fshRight">&nbsp;Shield:</td><td><input id="fshShield" type="checkbox" item="5"/></td><td class="fshRight">&nbsp;Ring:</td><td><input id="fshRing" type="checkbox" item="6"/></td><td class="fshRight">&nbsp;Amulet:</td><td><input id="fshAmulet" type="checkbox" item="7"/></td><td class="fshRight">&nbsp;Rune:</td><td><input id="fshRune" type="checkbox" item="8"/></td><td class="fshRight">&nbsp;Sets Only:</td><td><input id="fshSets" item="-1" type="checkbox"/></td><td></td><td class="fshRight">&nbsp;Max lvl:</td><td><input id="fshMaxLvl" size="5" value="9999"/></td></tr><tr><td colspan="2">&nbsp;[<span id="fshAll" class="fshLink">Select All</span>]</td><td colspan="2">&nbsp;[<span id="fshNone" class="fshLink">Select None</span>]</td><td colspan="2">&nbsp;[<span id="fshDefault" class="fshLink">Defaults</span>]</td><td colspan="6"></td><td><input id="fshReset" type="button" value="Reset"/></td></tr><tr><td class="fshRight">&nbsp;Quest Item:</td><td><input id="fshQuest" item="9" type="checkbox"/></td><td class="fshRight">&nbsp;Potion:</td><td><input id="fshPotion" item="10" type="checkbox"/></td><td class="fshRight">&nbsp;Resource:</td><td><input id="fshResource" item="12" type="checkbox"/></td><td class="fshRight">&nbsp;Recipe:</td><td><input id="fshRecipe" item="13" type="checkbox"/></td><td class="fshRight">&nbsp;Container:</td><td><input id="fshContainer" item="14" type="checkbox"/></td><td class="fshRight">&nbsp;Frag Stash:</td><td><input id="fshStash" item="16" type="checkbox"/></td><td class="fshRight">&nbsp;Composed:</td><td><input id="fshComposed" item="15" type="checkbox"/></td><td></td></tr><tr><td class="fshRight">&nbsp;Common:</td><td><input id="fshCommon" item="100" type="checkbox" checked/></td><td class="fshRight">&nbsp;Rare:</td><td><input id="fshRare" item="101" type="checkbox" checked/></td><td class="fshRight">&nbsp;Unique:</td><td><input id="fshUnique" item="102" type="checkbox" checked/></td><td class="fshRight">&nbsp;Legendary:</td><td><input id="fshLegendary" item="103" type="checkbox" checked/></td><td class="fshRight">&nbsp;Super Elite:</td><td><input id="fshSuperElite" item="104" type="checkbox" checked/></td><td class="fshRight">&nbsp;Crystalline:</td><td><input id="fshCrystalline" item="105" type="checkbox" checked/></td><td class="fshRight">&nbsp;Epic:</td><td colspan="2"><input id="fshEpic" item="106" type="checkbox" checked/></td></tr></table>',ot={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},lt={Perfect:{abbr:"Perf",colour:"#00b600",index:8},Excellent:{abbr:"Exc",colour:"#f6ed00",index:7},"Very Good":{abbr:"VG",colour:"#f67a00",index:6},Good:{abbr:"Good",colour:"#f65d00",index:5},Average:{abbr:"Ave",colour:"#f64500",index:4},Poor:{abbr:"Poor",colour:"#f61d00",index:3},"Very Poor":{abbr:"VPr",colour:"#b21500",index:2},Uncrafted:{abbr:"Unc",colour:"#666666",index:1}}
function ft(t){return lt[t]?lt[t].abbr:""}function ut(t,e){const n=function(t){return t.folder_id?function(t){return t.equipped?"fshGreen":"fshNavy"}(t):function(t){return-1===t.player_id?"fshNavy":"fshMaroon"}(t)}(e)
t.classList.add(n)}function pt(t){return function(t){return t.player_id&&-1!==t.player_id}(t)||function(t){return t.folder_id&&-1!==t.guild_tag}(t)}function ht(t){return`<span class="fshLink recallItem" invid="${t.inv_id}" playerid="${n(t.player_id,z.player_id)}" mode="1" action="recall">GS</span>`}function mt(t){return`<span class="fshLink storeItem" invid="${t.inv_id}">GS</span>`}function bt(t,e,n){return"display"===t?n(e):"GS"}function yt(t,e){const n=function(t){return-1===t.player_id?4:pt(t)?7:1}(e),a=function(t,e,n){return t||(-1!==e?e:n)}(z.player_id,e.player_id,z.guild_id)
let r=t
e.equipped&&(r=`<b>${t}</b>`)
let d=""
return function(t){return t.stats&&""!==t.stats.set_name}(e)&&(d=` (<span class="fshLink setName" set="${e.stats.set_name}">set</span>)`),`<a href="${i}${t}" class="fshInvItem tip-dynamic ${s[e.rarity].clas}" data-tipped="fetchitem.php?item_id=${e.item_id}&inv_id=${e.inv_id}&t=${n}&p=${a}">${r}</a>${d}`}const vt=[[t=>t.player_id&&-1===t.player_id,(t,e)=>'takeItem" action="'+e.a],[t=>t.player_id&&t.player_id!==z.current_player_id,(t,e)=>`recallItem" playerid="${t.player_id}" mode="0" action="${e.a}`],[t=>function(t){return t.folder_id&&!t.equipped}(t)||function(t){return t.player_id&&!t.equipped&&t.player_id===z.current_player_id}(t),(t,e)=>e.c]]
function gt(t,e){const n=vt.find(e=>e[0](t))
return n?`<span class="fshLink ${n[1](t,e)}" invid="${t.inv_id}">${e.b}</span>`:""}function kt(t){return n(t.folder_id,t.player_id)}function _t(e){return t.membrList[e]?t.membrList[e].username:"???"}function $t(t,e){return t[0]-e[0]}function xt(t,e){return`<option value="${e[0]}"${O(Number(e[0]),t)}>${e[1]}</option>`}let It,Rt,Lt
function Mt(t){It=d({},dt),d(It,n(t,{})),Rt=c("showQuickDropLinks"),Lt=c("showQuickSendLinks")}const Et=[{title:"Name",data:"item_name",render:function(t,e,n){return"display"!==e?t:yt(t,n)}},{title:"Level",data:"stats.min_level"},{title:"Where",data:kt,render:{_:function(t,e,n){return n.folder_id?function(t){return t.equipped?-2:t.folder_id}(n):-1===n.player_id?"~":_t(n.player_id)},display:function(t,n,i){return i.player_id?function(t){return-1===t.player_id?"Guild Store":`<a class="fshMaroon" href="${r}${t.player_id}">${_t(t.player_id)}</a>`}(i):i.equipped?"Worn":`<select class="fshMoveItem" data-inv="${i.inv_id}">${s=i.folder_id,d=z.folders,a(d).sort($t).map(e(xt,s)).join("")}</select>`
var s,d},filter:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":_t(t.player_id)}(n):n.equipped?"Worn":z.folders[n.folder_id]}}},{title:"Type",data:"type",render:t=>o[t]},{title:"Att",data:"stats.attack"},{title:"Def",data:"stats.defense"},{title:"Arm",data:"stats.armor"},{title:"Dam",data:"stats.damage"},{title:"HP",data:"stats.hp"},{title:"Frg",data:"forge",render:function(t,e,n){if(n.type<9)return n.forge}},{title:"Craft",data:"craft",render:{_:t=>lt[t]?lt[t].index:0,display:ft,filter:ft}},{title:"Du%",data:"durability",render:function(t,e,n){if(n.type<9&&n.max_durability>0)return Math.ceil(n.durability/n.max_durability*100)}},{title:"BP",data:kt,render:function(t,e,n){if(!n.folder_id&&n.player_id!==z.current_player_id)return function(t,e){return"display"!==t?"BP":-1===e.player_id?`<span class="fshLink takeItem" invid="${e.inv_id}" action="take">BP</span>`:`<span class="fshLink recallItem" invid="${e.inv_id}" playerid="${e.player_id}" mode="0" action="recall">BP</span>`}(e,n)}},{title:"GS",data:kt,render:function(t,e,n){return pt(n)?bt(e,n,ht):function(t){return t.folder_id&&!t.bound}(n)?bt(e,n,mt):void 0}},{title:"W/U",data:"type",render:function(t,e,n){const i=[1,1,1,1,1,1,1,1,1,,2,2,,,,2][t]
return 1===i?gt(n,{a:"wear",b:"Wear",c:"wearItem"}):2===i?gt(n,{a:"use",b:"Use",c:"useItem"}):void 0}},{title:"setName",data:"stats.set_name",orderable:!1,visible:!1},{title:"Tag",data:"guild_tag",render:t=>-1===t?"No":"Yes"},{title:"Drop",data:"type",render:function(t,e,n){if(!function(t){return-1!==t.guild_tag||t.equipped}(n))return"display"!==e?"Drop":`<span class="dropItem tip-static dropLink" data-tipped="INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Drop</span>`}},{title:"Send",data:"type",render:function(t,e,n){if(!function(t){return t.equipped||-1===t.guild_tag&&t.bound}(n))return"display"!==e?"Send":`<span class="sendItem tip-static sendLink" data-tipped="INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Send</span>`}}]
function St(){return"player_id"in z}function jt(){const t=function(){const t=I({className:"hover fshXSmall",id:St()?"fshUserInv":"fshGuildInv"})
return l(f,t),t}()
return function(t){t.column(12).visible("current_player_id"in z),t.column(17).visible(St()&&Rt),t.column(18).visible(St()&&Lt)}(function(t){return $(t).DataTable({autoWidth:!1,columnDefs:[{targets:"_all",defaultContent:""},{targets:[1,4,5,6,7,8,9,10,12,13],orderSequence:["desc","asc"]}],columns:Et,createdRow:ut,data:z.items,deferRender:!0,lengthMenu:[[50,100,150,200,-1],[50,100,150,200,"All"]],pageLength:50,stateDuration:0,stateSave:!0})}(t)),t}function Dt(t){return L(t).then(A)}function Tt(e){_("fsh_"+t.subcmd,e)}function Nt(){u('table.fshInvFilter input[type="checkbox"]').forEach(t=>{t.checked=1===It.checkedElements[t.getAttribute("item")]}),Tt(It)}function wt(t){It.checkedElements=ot,Nt(),$(t).DataTable().draw(!1)}function At(t,e){It.fshMinLvl=t,It.fshMaxLvl=e,Tt(It)}function Gt(t){$(t).DataTable().draw(!1)}function qt(t){C(At,e(Gt,t))}function Pt(t){return Number(t[0])>=100}function Ut(t,e){return t[e[0]]=e[1],t}function Ct(t){var e
It.checkedElements=(e=It.checkedElements,a(e).filter(Pt).reduce(Ut,{})),Nt(),$(t).DataTable().draw()}function Ot(t,e){t.eq(e).empty()}function Ft(t,n){if(1===n.r)return
const i=t.closest("tr")
!function(t){[2,12,13,14,15,16].forEach(e(Ot,t))}($("td",i)),i.css("text-decoration","line-through")}function Wt(t,n){p(n),function(t){t.closest("tr").find(".takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem").removeClass()}(n),t().then(e(Ft,n)),function(t){t.empty().append(`<img src="${h}ui/misc/spinner.gif" width="11" height="11">`)}(n)}function Bt(t){return E({cmd:"profile",subcmd:"dodropitems",removeIndex:t,ajax:1}).then(w)}function Vt(t){It.checkedElements={},u('table.fshInvFilter input[type="checkbox"][item]:checked').forEach(t=>{It.checkedElements[t.getAttribute("item")]=1}),Tt(It),$(t).DataTable().draw(!1)}function Ht(t){It.checkedElements=dt.checkedElements,Nt(),$(t).DataTable().draw(!1)}function Yt(t){It.fshMinLvl=dt.fshMinLvl,It.fshMaxLvl=dt.fshMaxLvl,Tt(It),$("#fshMinLvl").val(It.fshMinLvl),$("#fshMaxLvl").val(It.fshMaxLvl),$(t).DataTable().draw(!1)}function Qt(t){return function(t){return V({subcmd2:"dostoreitems",storeIndex:t})}(t)}function zt(t){return Qt(t).then(M).then(A)}function Jt(t,e){$(t).DataTable().search($(e.target).attr("set")).draw(),$(`#${t.id}_filter input`).trigger("focus")}function Xt(t){const n=$(t.target)
Wt(e(W,n.attr("invid"),n.attr("action")),n)}function Kt(t){const n=$(t.target)
Wt(e(B,n.attr("invid"),n.attr("playerid"),n.attr("mode"),n.attr("action")),n)}function Zt(t){const n=$(t.target)
Wt(e(G,n.attr("invid")),n)}function te(t){const n=$(t.target)
Wt(e(q,n.attr("invid")),n)}function ee(t){const e=$(t.target)
var n,i
n=[e.data("inv")],i=e.val(),E({cmd:"profile",subcmd:"sendtofolder",inv_list:JSON.stringify(n),folder_id:i,ajax:1}).then(w)}function ne(t){const n=$(t.target)
Wt(e(zt,[n.attr("invid")]),n)}function ie(t){const n=$(t.target)
Wt(e(Bt,[n.data("inv")]),n)}function se(t){const n=$(t.target)
Wt(e(Dt,[n.data("inv")]),n)}function ae(t,n){$(n[0]).on("click",e(n[1],t))}function re(t,e){$(t).on("click","span."+e[0],e[1])}function de(t){!function(t){[["#fshReset",Yt],["#fshAll",wt],["#fshNone",Ct],["#fshDefault",Ht]].forEach(e(ae,t))}(t),$("table.fshInvFilter").on("click",'input[type="checkbox"]',e(Vt,t)),function(t){[["setName",e(Jt,t)],["takeItem",Xt],["recallItem",Kt],["wearItem",Zt],["useItem",te],["dropItem",ie],["sendItem",se],["storeItem",ne]].forEach(e(re,t))}(t)}function ce(){let t
t=z.player_id?`<b>&nbsp;Inventory Manager</b> ${z.items.length} items (green = worn, blue = backpack)`:`<b>&nbsp;Guild Inventory Manager</b> ${z.items.length} items (maroon = in BP, blue=guild store)`,m(ct.replace("@@reportTitle@@",t),f)}function oe(){$("#fshMinLvl").val(It.fshMinLvl),$("#fshMaxLvl").val(It.fshMaxLvl)}let le
function fe(t,e){return j(le,k(e[1]),It.fshMinLvl,It.fshMaxLvl)}function ue(){le=[t=>0===t].concat(D),$.fn.dataTable.ext.search.push(fe)}function pe(){$.fn.dataTable.ext.search.push((t,e,n,i)=>!It.checkedElements||It.checkedElements[i.type])}function he(){$.fn.dataTable.ext.search.push((t,e,n,i)=>!It.checkedElements||!It.checkedElements[-1]||function(t){return It.checkedElements[-1]&&t.stats&&-1!==t.stats.set_id}(i))}function me(){$.fn.dataTable.ext.search.push((t,e,n,i)=>{const s=(parseInt(i.rarity,10)+100).toString()
return!It.checkedElements||It.checkedElements[s]})}function be(t,e){return t[e[1].id]=e[1],t}function ye(){t.membrList=a(t.membrList).filter(H).reduce(be,{})}function ve(){R([rt,ue,pe,he,me,ce,Nt,oe])
const t=jt()
!function(t){$("#fshMinLvl, #fshMaxLvl").on("keyup",e(qt,t)),$(t).on("change","select.fshMoveItem",ee),de(t)}(t),$("#fshRefresh").on("click",_e),function(t){const n=$(`#${t.id}_filter input`)
n.prop("type","text")
const i=$("<span>&times;</span>")
n.wrap($('<span class="text-input-wrapper"/>')),n.after(i),i.on("click",e(at,t,n))}(t)}function ge(){ve()}function ke(){v(3,ge)}function _e(){b()||(m(`<span id="fshInvMan"><img src = "${y}">&nbsp;Getting inventory data...</span>`,f),function(){const e=[T(),st()]
"guildinvmgr"===t.subcmd&&e.push(F(!1).then(ye)),e.push(x("fsh_"+t.subcmd).then(Mt)),U(e,ke)}())}export default _e
//# sourceMappingURL=inventory-48a4efa8.js.map
